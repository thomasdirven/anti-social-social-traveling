<div fxLayout="column" fxLayoutGap="2%">
  <app-add-trip (newTrip)="addNewTrip($event)"></app-add-trip>
  <mat-card>
    <form>
      <mat-form-field>
        <input
          matInput
          placeholder="City to filter on"
          type="text"
          (keyup)="this.filterTripCity$.next($event.target.value)"
          #filterCityValue
        />
        <button
          mat-button
          *ngIf="filterTripCity"
          matSuffix
          mat-icon-button
          aria-label="Clear"
          (click)="this.filterTripCity$.next('')"
          (click)="filterCityValue.value = ''"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
      <span> &nbsp; | &nbsp; </span>
      <mat-form-field>
        <input
          matInput
          placeholder="Country to filter on"
          type="text"
          (keyup)="this.filterTripCountry$.next($event.target.value)"
          #filterCountryValue
        />
        <button
          mat-button
          *ngIf="filterTripCountry"
          matSuffix
          mat-icon-button
          aria-label="Clear"
          (click)="this.filterTripCountry$.next('')"
          (click)="filterCountryValue.value = ''"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
      <span> &nbsp; | &nbsp; </span>
      <!-- <form [formGroup]="tripFilterDateRangeFG"> -->
      <mat-form-field appearance="fill">
        <mat-label>Filter on date range</mat-label>
        <mat-date-range-input [rangePicker]="picker">
          <input
            matStartDate
            placeholder="Start date"
            (dateInput)="inputEventStartDate($event)"
          />
          <input
            matEndDate
            placeholder="End date"
            (dateInput)="inputEventEndDate($event)"
          />
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
        <!-- 
      <mat-error
        *ngIf="tripFG.controls.startDate.hasError('matStartDateInvalid')"
        >Invalid start date</mat-error
      >
      <mat-error
        *ngIf="tripFG.controls.endDate.hasError('matEndDateInvalid')"
        >Invalid end date</mat-error
      > -->
      </mat-form-field>
      <span> &nbsp; | &nbsp; </span>
      <!-- type="reset" sounds great, doesn't work, placeholders don't fall back into place -->
      <button
        mat-raised-button
        type="reset"
        (click)="this.filterTripDateRange[0] = null"
        (click)="this.filterTripDateRange[1] = null"
        (click)="this.filterTripCity$.next('')"
        (click)="filterCityValue.value = ''"
        (click)="this.filterTripCountry$.next('')"
        (click)="filterCountryValue.value = ''"
      >
        Reset Filters
      </button>
    </form>
  </mat-card>

  <!-- card that allows you to geocode location and put marker on map -->
  <!-- <app-geocode></app-geocode> -->
  <!-- turned of to save free credit on https://console.cloud.google.com/ -->

  <!-- <div #scrollingTrips class="tripsScroll"> -->
  <!-- if statement no longer working -->
  <!-- because behaviorObservables are never empty? -->
  <!-- <div *ngIf="trips$ | async as trips; else loadingOrError"> -->
  <div>
    <div #scrollingTrips class="tripsScroll">
      <div *ngIf="trips$ | async as trips">
        <div *ngIf="trips.length > 0; else loadingOrError">
          <div
            fxLayout.xs="column"
            fxLayoutGap=""
            fxLayoutAlign="center"
          >
            <div
              class="trip"
              *ngFor="
                let trip of trips
                  | tripFilterCity: filterTripCity
                  | tripFilterCountry: filterTripCountry
                  | tripFilterDateRange: filterTripDateRange
              "
              fxFlex="0 0 calc(33%-0.5)"
              fxFlex.xs="100%"
            >
              <!-- is hoverTrip a local variable in this html file?? -->
              <!-- it works, but how? -->
              <app-trip
                [trip]="trip"
                (mouseenter)="hoverTrip = trip"
                (mouseleave)="hoverTrip = null"
              ></app-trip>
            </div>
          </div>
        </div>
        <ng-template #loadingOrError>
          <mat-card class="error" *ngIf="errorMessage; else loading">
            Error loading the city trip list: {{ errorMessage }}. <br />
            Please try again later.
          </mat-card>
        </ng-template>
      </div>
    </div>
    <div *ngIf="trips$ | async as trips">
      <div *ngIf="trips.length > 0">
        <div
          class="bigIconRight"
          (mouseover)="scrollDiv(scrollingTrips, -300)"
          (mouseleave)="stopTimer(timer)"
        >
          <mat-icon [ngStyle]="{ color: 'blue' }">skip_next</mat-icon>
        </div>
        <div
          class="bigIconRight"
          (mouseover)="scrollDiv(scrollingTrips, -30)"
          (mouseleave)="stopTimer(timer)"
        >
          <mat-icon [ngStyle]="{ color: 'purple' }">fast_forward</mat-icon>
        </div>
        <div
          class="bigIconRight"
          (mouseover)="scrollDiv(scrollingTrips, -8)"
          (mouseleave)="stopTimer(timer)"
        >
          <mat-icon [ngStyle]="{ color: 'darkgreen' }">fast_forward</mat-icon>
        </div>
        <div
          class="bigIconLeft"
          (mouseover)="scrollDiv(scrollingTrips, 300)"
          (mouseleave)="stopTimer(timer)"
        >
          <mat-icon [ngStyle]="{ color: 'blue' }">skip_previous</mat-icon>
        </div>
        <div
          class="bigIconLeft"
          (mouseover)="scrollDiv(scrollingTrips, 30)"
          (mouseleave)="stopTimer(timer)"
        >
          <mat-icon [ngStyle]="{ color: 'purple' }">fast_rewind</mat-icon>
        </div>
        <div
          class="bigIconLeft"
          (mouseover)="scrollDiv(scrollingTrips, 8)"
          (mouseleave)="stopTimer(timer)"
        >
          <mat-icon [ngStyle]="{ color: 'darkgreen' }">fast_rewind</mat-icon>
        </div>
        <div class="indicator">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>    
  <ng-template #loading>
    <mat-spinner></mat-spinner>
  </ng-template>
  <!-- shows google maps on webpage with markers of trip locations -->
  <div *ngIf="trips$ | async as trips">
    <app-gmap
      [trips]="
        trips
          | tripFilterCity: filterTripCity
          | tripFilterCountry: filterTripCountry
          | tripFilterDateRange: filterTripDateRange
      "
      [hoverTrip]="this.hoverTrip"
    ></app-gmap>
    <!-- turned of to save free credit on https://console.cloud.google.com/ -->
  </div>
</div>
